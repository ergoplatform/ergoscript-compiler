package util

import org.scalatest.{Matchers, WordSpec}

class CompilerSpec extends WordSpec with Matchers {

  "Compiler" should {

    "compile LiveEpochScript correctly" in {
      val (ergoTree, hash, address) = Compiler.compile("src/test/resources/live_epoch.es", Some("src/test/resources/live_epoch_symbols.json"))

      ergoTree shouldBe "1014040004000e20749fe0b8c63213be3451af2578eacabd620a9e687f5c55c54f1ec571b17c9c850400040004020402010104020580b48913040204060500043c04020480b489130402050a05c8010402d806d601b2a5730000d602b5db6501fed9010263ed93e4c67202050ec5a7938cb2db63087202730100017302d603b17202d604e4c6b272027303000605d605d90105049590720573047204e4c6b272029972057305000605d606b07202860273067307d901063c400163d803d6088c720601d6098c720801d60a8c72060286029a72097308ededed8c72080293c2b2a5720900d0cde4c6720a040792c1b2a5720900730992da720501997209730ae4c6720a0605ea02d1ededededededed93cbc27201e4c6a7060e927203730b93db63087201db6308a793e4c6720104059db07202730cd9010741639a8c720701e4c68c72070206057e72030593e4c6720105049ae4c6a70504730d92c1720199c1a77e9c9a7203730e730f058c72060292da720501998c72060173109972049d9c720473117312b2ad7202d9010763cde4c672070407e4c6b2a5731300040400"
      hash shouldBe "31290f347f33d70dd573661b744b19cbe431f581802b8920e85192e2b6eecb1f"
      address shouldBe "8D6pdYVRvF6PcDZZ8HXaEv1VyWmYC8VV5mfmuVPCBHLCzzjWUu6vvrpJvN8uT7rJMKzJbGmVcaDJirPFeuTV1jgk3E1sF8KYKaQjvohyXfPsZhCqhsQ8oh5c3EKbmC4DeMBBxaEzUZZFmvFwpsoGMJvhwQKpwuEQZruTwdzjUxwfFMKyNtTBbAr3Pmz6NeB5ewyj2bSFcfN791G2jKB3VENA7pncaX3bPhL6aEDJstFBELa9a7uTeevA1sjcUwTyUDfShwyM2hE1RxRrCFMfiuzcR3nJYVLEsn3Y1ge6ThjQg8H3xFpXsJ6SfXtFhX2PdnhyjMD9mtkCjM6icsqNp12R7J58HenC1fv8KpuBU7GEmQAHEFr28Gr8GKafhiTsXzjtqbiV9b78A4wtWUBgbEPfrKhV1eB3fVKPQ73Gw8xwxTLBbXLKyVHT9kcrnUPQBGij4H1oaeNz2cr7eMdwiP2aA4XjUHDnct7ZiHn243UnqP7gveBGf1fcZMYNkjiXhFCRsjMhBQtjE9gtBMNoTJd3Y9tdjYn1YcHWbKQLvj27eD4XXpSSEXodBFuhM"
    }

    "compile EpochPrepScript correctly" in {
      val (ergoTree, hash, address) = Compiler.compile("src/test/resources/epoch_prep.es", Some("src/test/resources/epoch_prep_symbols.json"))

      ergoTree shouldBe "100604000580b48913043c0e20396b67b43d9436bb1f310050273f6f34b81beeca1ebea1f126486890d00a282c04280408d806d601b2a5730000d602c67201060ed603e4c6a70504d604c1a7d6059272047301d6069aa3730295e67202d801d607ed93e47202cbc2a793cbc272017303eb02d1ededededededed8fa3720391a39972037304720593e4c672010405e4c6a7040593e4c672010504720393db63087201db6308a792c1720172047207d1ededededededed92a37203720593e4c672010405e4c6a7040592e4c672010504720690e4c6720105049a7206730593db63087201db6308a792c1720172047207d1edededed93e4c672010405e4c6a7040593e4c672010504720393c27201c2a793db63087201db6308a791c172017204"
      hash shouldBe "d998e06e0c093b0990fa3da4f3bea4364546803551ea9cac02623e9675ba4522"
      address shouldBe "Gxd4hMRT5wUQ8JTfx9rqwTCXM8MZ5VC1143qtV393Cvum7kVyKkW1rAkj3FoHzFn44X94BQwsVFMdSibu9euVToxYPVpJMNnbqA83wst4jiYUMV1bFp5M4pgESHdD1mFieimi6z3dhZbtdsV2zQeShZCFBr6gXdnzuuRQAM9zXQuUGW4JfaXoz1FjFgRERRaxGGyD7gK61KwiRTCoZMDjZ1vmUuvfUfQda45j61fD8BZ1r3JMCX6h8vP9ZuRjDmheGLBdsqhf3rg6JV4xqsuqnSbhGXaTvNucPcA7EH4MAEj6jTkWvazv1nRMBM5kY6FpNQ4vQsbQFuJSciA2ZWTxS7dfyicYXZ6aCrBnmNi78u6bfQt2gKpHYq5Uh8sLUAPG3xXrjmETPmVf7"
    }

    "compile DataPointScript correctly" in {
      val (ergoTree, hash, address) = Compiler.compile("src/test/resources/data_point.es", Some("src/test/resources/data_point_symbols.json"))

      ergoTree shouldBe "100604000400050004000e200fb1eca4646950743bc5a8c341c16871a0ad9b4077e3b276bf93855d51a042d10e20396b67b43d9436bb1f310050273f6f34b81beeca1ebea1f126486890d00a282cd803d601b2a5730000d602e4c6a70407d603b2db6501fe730100ea02d1ededededed93e4c672010407720293e4c67201050ec5720391e4c672010605730293c27201c2a793db63087201db6308a7ed938cb2db6308720373030001730493cbc272037305cd7202"
      hash shouldBe "d0b341ec5b6b8e5b0f941facfdd452dace419273abd78a17d3e0710e3a96630e"
      address shouldBe "jL2aaqw6XU61SZznvnw681zGfmUQkZouLZ8uvwy36MJRbqZRxr7sFbLJKMDEFy42CBLZRCV3CazTqnnSooxnSptybik3VcMUTZcgGcicXN78topRx5qXK1xNVwn9FkBkyCb9umnhx967ixNwYd1z8xmWkbdLKNdbDLqGEKbVYbtFTY7qoY8VU3bDV4TRbp2D7G9MNoXDaEvVeLeymGSMuJC5sp4dptTRc9QSR158sJYppQYkAsSgwXbtoNJvq"
    }

    "compile PoolDepositScript correctly" in {
      val (ergoTree, hash, address) = Compiler.compile("src/test/resources/pool_deposit.es", Some("src/test/resources/pool_deposit_symbols.json"))

      ergoTree shouldBe "100804000e20d998e06e0c093b0990fa3da4f3bea4364546803551ea9cac02623e9675ba4522040004000500040004000e200fb1eca4646950743bc5a8c341c16871a0ad9b4077e3b276bf93855d51a042d1d802d601b2a4730000d602c27201d1ededed93cb7202730193c2b2a5730200720292c1b2a57303009ac17201b0b5a4d901036393c27203c2a77304d9010341639a8c720301c18c720302938cb2db6308b2a5730500730600017307"
      hash shouldBe "70ff2ce77ce8098ca1fb1f4f06c3c389eed1efa2dc283fcb94fb5ecafffd4d1f"
      address shouldBe "zLSQDVBaKPo3b92KyHXfjph18fbHyVCkNEt9WaWzQVc7LnfRKTwoBFzryPE2bEukR4jP8mDiRVgBtKM6peYGb1Rq6Hbi5y9qja5B7mBtRdhEPqJzc66WN74QbQ1yvBMJQzGNjD85xpiPgW3mEJ8NvLuYAZL97vkUYZzMEa38FVesfTPYsMn9bqiTX5ZL5ogimzRL9nFyaMbp3wDTZQNeJDhaJjr5mS7BvsrdjTwmiLsXFZVpcw"
    }

    "compile AgeUSD v0 contract correctly" in {
      val (ergoTree, hash, address) = Compiler.compile("src/test/resources/AgeUSD.es", Some("src/test/resources/AgeUSD_symbols.json"))

      ergoTree shouldBe "102b0400040004000e200fb1eca4646950743bc5a8c341c16871a0ad9b4077e3b276bf93855d51a042d10400040204020400040004020500050005c8010500050005feffffffffffffffff0105000580897a05000580897a05c80104f2aa3205c00c0580a8d6b907050005c8010580dac409050005000404040405000501050005a0060101050005a0060100040004000e2077d14a018507949d1a88a631f76663e8e5101f57305dd5ebd319a41028d804560400d802d601db6501fed602b17201d1ec959172027300d821d603b27201730100d604938cb2db63087203730200017303d605b2a5730400d606c17205d607db6308a7d608b27207730500d6098c720802d60adb63087205d60bb2720a730600d60c8c720b02d60d947209720cd60eb27207730700d60f8c720e02d610b2720a730800d6118c721002d61294720f7211d613e4c6a70505d614e4c672050505d615e4c6a70405d616e4c672050405d617b2a5730900d618e4c672170405d61995720d730a7218d61a95720d7218730bd61bc1a7d61ce4c672170505d61d9de4c672030405730cd61ea2a1721b9c7215721d730dd61f9572129ca1721d95937215730e730f9d721e72157219d801d61f99721b721e9c9593721f7310731195937213731273139d721f7213721ad6209d721f7314d6219c7216721dd6229591a3731573167317d62395937221731872229d9c720673197221edededed7204ededededed927206731a93c27205c2a7edec720d7212efed720d7212ed939a720972139a720c7214939a720f72159a72117216edededed939a721572197216939a7213721a7214939a721b721c7206927216731b927214731ceded938c7210018c720e01938c720b018c720801938cb2720a731d00018cb27207731e000193721c9a721f958f7220731f9c722073207220957212959172197321927223732273239591721a73249072237222927223732572047326ed938cb2db6308b2a4732700732800017329937202732a"
      hash shouldBe "2ffa0259301a5c7cdcf3074f7e5625f4764ca42453102804d4a774c6b39cc2e9"
      address shouldBe "29irJ65SHH5VxgQaXubC1z9eHzutUWV6BB2QGCbA9eQ53msbyzXdh6bSXm64WMwkiBNRgeXZy1ySSvVuKtEE4ifUbdXiV4PtdqsdxWxrhmJoqnDHSimsCz2zLsUGFm9j16kivMoS3ek4JPzvxuLddru5DLGaLJaLqN3dSjrY398Puyd2SxaxmUNpLy4PscVv8Gs7x4TYdBffnb9CvTZekitcwgu8hqgzU9yFHo37czxDJSg95gMyevKUivy7wfoxinoCdpKcN8WnHQ8jXA6kVxt2n55EAjJpaP6RkXRdszWAxZGFYHGvaNrRoFzThkpddgtm23P2ayQAYcUyTky8LtAgep1DpPueLWw25tN3hebEkfBy5K95vThXk5ChCBrxKzi6jFtWARdJ7Gm3F61L44jjhBn4qCFizqyJJ62axxhSv8sPnMXu8Je4sSFo9UBCheNoobYDyteatm8RpKLR6vDiKyZSyhKBYgcccNfCfhHHj8N6qr1gYueVvkb6SMxQpFbtHV8pqvdUUKhThNMVRkeBQz6ZeuPdnXEXBU5HZsJbT4oN51T5jUEfF5FfHWHuX9bnC9wfLzx7z7fehiSNdfb1XSG1UDfgs2sDZD6G6TJ5TQev8s5nXtUaJoz3xddnfxLnYDFjJqZnnhQSqmtndBkPZGHgRmt2fY4UxF2AqZ7E6RrK3d6QtaXkYAyLke7GrDTbUgAGXUtizy3tEhAtK3dy46oCVMdkqA2go4iXZ1gFVeuzxGPAvEUW8gRsHHSyP3hAeA7n1tbS9qRajCFB19YLnSd8UPRzkBU4e4NdAneZqZ5TqK9T34eusMLqqriJ1Qp7oAVcG2tbtik82nzX8WhctoXFGQJh1UAeJKFpQ22YCUX7vR17BwehSjpRwc5EK5ZqtCnGpUsfmGY6eyc1txwGRT1AS2m9NYweAmGh7Eq8VZbaXtbJUAhdLrBD8GpVnYjCzZiboZxyokbjFqmifFLYVkRXoZLG7CzqSEBhgtiew"
    }

    "compile AgeUSD v0 update contract correctly" in {
      val (ergoTree, hash, address) = Compiler.compile("src/test/resources/AgeUSD_update.es", Some("src/test/resources/AgeUSD_update_symbols.json"))

      ergoTree shouldBe "100c04000402040204000580dac40904000e20dd26438230986cfe7305ad958451b69e55ad5ac37c8a355bfb08d810edd7a20f05000400050c04040e207bd873b8a886daa7a8bfacdad11d36aeee36c248aaf5779bcd8d41a13e4c1604d80bd601c5a7d602b2a4730000d603b2a4730100d604db63087203d605b2a5730200d606c27205d607e4c67202040ed608b2a5730300d609e4c67208040ed60ac27202d60bc27208d1ed937201c57202ecedededed93720b720a92c17208730493db63087208db63087202947209720792b0b5db6501fed9010c63eded938cb2db6308720c73050001730693e4c6720c040e720993e4c6720c050e72017307d9010c41639a8c720c018cb2db63088c720c02730800027309ededededededed938cb27204730a0001730b937204db6308720593e4c6a7040ecb720694c27203720693e4c672030405e4c67205040593e4c672030505e4c67205050593c17203c17205ededed937207720993720a720b93db63087202db6308720893c17202c17208"
      hash shouldBe "cc3cb558cc31a838bea7ab0bb62357e572ac4a10e65b8c5b418edc4228c60840"
      address shouldBe "6Vs43fLottAzin3EiEiswbSD31ETscqBLy9i3zTWCwUVuG79fWuP7S3Kko5PEK56UEBWSTE8GuuXq3gMfYSUNJ1ujSTy5yKzrAHRGLk5rw1UTecdQZfPJTdpxMvkEvG9TYm4ie8E3z1MMfTJ3wzPxgQ2fhHzxaCLZAdNPF3Ji56VktsB4kQZsadxQDbYjwXWAxypA1YkRzLujhmPZELJR6EiRz2pdR15iKPNJh6pDo3CFqb9eySCbHk1EgwPo8C6nvHpqyb2c6bKkW2p4vQL2BudZhq6CZPToCGd376EZy3mgawmeWePrvFCrCDsrnEccfkr3PhcvtRqHzJD7m2oTFfmyiWvD7NakGh3woNU8XEV4uKULieaHWbs21M3mDe4CZ7Vg477GeWkqc8jaP4LGjfuEM5cqpNyct8CYrYoJCDB18RhWqtCL2ddEBwFCXRiFujrKQjSbncSJ2xd4BkmBcHrjBzskMAat1N6A72ZN8KNYsWBQBRLX4VoJwVTvtaSFAuCSBaDtoq1uwVG"
    }

    "compile AgeUSD v1 (without update) contract correctly" in {
      val (ergoTree, hash, address) = Compiler.compile("src/test/resources/AgeUSD_without_update/AgeUSD.es", Some("src/test/resources/AgeUSD_without_update/AgeUSD_symbols.json"))

      ergoTree shouldBe "10270400040004000e2054acaa0c6d5d3bc66b88364a423b5f156ed763f7236d437adb44d70787bc0f950400040204020400040004020500050005c8010500050005feffffffffffffffff0105000580897a05000580897a05c80104e0be3405c00c0580a8d6b907050005c8010580dac409050005000404040405000501050005a0060101050005a0060100d801d601db6501fed19591b172017300d821d602b27201730100d603938cb2db63087202730200017303d604b2a5730400d605c17204d606db6308a7d607b27206730500d6088c720702d609db63087204d60ab27209730600d60b8c720a02d60c947208720bd60db27206730700d60e8c720d02d60fb27209730800d6108c720f02d61194720e7210d612e4c6a70505d613e4c672040505d614e4c6a70405d615e4c672040405d616b2a5730900d617e4c672160405d61895720c730a7217d61995720c7217730bd61ac1a7d61be4c672160505d61c9de4c672020405730cd61da2a1721a9c7214721c730dd61e9572119ca1721c95937214730e730f9d721d72147218d801d61e99721a721d9c9593721e7310731195937212731273139d721e72127219d61f9d721e7314d6209c7215721cd6219591a3731573167317d62295937220731872219d9c720573197220edededed7203ededededed927205731a93c27204c2a7edec720c7211efed720c7211ed939a720872129a720b7213939a720e72149a72107215edededed939a721472187215939a721272197213939a721a721b7205927215731b927213731ceded938c720f018c720d01938c720a018c720701938cb27209731d00018cb27206731e000193721b9a721e958f721f731f9c721f7320721f957211959172187321927222732273239591721973249072227221927222732572037326"
      hash shouldBe "4e1de8a8048c66fe1f0592ee11aa8c37a1ccf7480b55be39a49270049dec828e"
      address shouldBe "2zYVHmdQDGtyyZfeqFPdMFqWzMdK299yCj5uDJjiSxRgpHyjiV3mVfZCimFbEVkNkCuypT1khjhupnEb6af3ztdatgag24UzLjW7heidiBF4MqK42TBZC1mLNcm851mdBMW88XX81fNZnDW33C3DyuDSXSZmcpdasxr2GCRntrw6USxLQPxtxGpm8kp95iFHbiQfytk8mqFwJH5Lr3NrwFQWG9aNK7Ud4rTiT5S5SDMREAnQ76orAjbBjHspAh6t9hKgs2UnEj3EsC819oVRfaGmbCQStcnoKNUNYPSbBT7y1sGZL1gy5tXGvEwvX6TxEzgYyKmLq6MX9k2Zpqwtky6ERxkF7RVqvbQL28KLqf7VzqmsRU5WtLVSnJnuxS9XaJRC6WM5MH8fxhjvS4V9abodzVpyxEgMYiAmM9Jb72TLWvhJeE66rbLpqZD7CNrieUQbJaSJR5q2QqvehSdrecZRbapa4SLQYPnumHPgmd2okjTQs7dXecprHyGDH7P1TgBf66Rso2zNHryx3UCnPXRuZsWMjcv8cjk9dUjbSXqj1KQC3BEpcBkS8LULCuVNhbFYrd2e4uSXvbKg7qvFznJZonKVwXPN2meVWqJqFHgwZvZ98r8EQSFkRq1yauNPqkvzzQZ7Bep1wUELopBxT5J6ikucitYwEzXXLerSxWFAuqMYTJ2WUPyjcJphxo8Z6NHLiCGXfhFu26g4W5XBMSE4iTVZwHk8VcRd5Q6CqAa4tBPmmSxz2JCnjhpH2imZcNmjT2NH5QMmgFhpARktDcUhGHHQM9njEFcEGXqxCkGrrdqLChA1buM6YpBMgSPEMQGPrjQ7skzRjftE3Aq1mpZwAxnp3xEokPrnHmRXqHRgZoUZcoxhG6S4uhfmcM3KdJZvLAvn2YFHWcUk"
    }

  }

}
